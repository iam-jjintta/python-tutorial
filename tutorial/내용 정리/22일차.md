# 흔한 찐따의 파이썬 22일차 내용 정리
오늘은 코루틴에 대해 공부하였다.
그동안 배웠던 개념들처럼 나에게는 굉장히 어려운 개념이었다.

때문에 한번에 소화하는 것이 불가능해서 이 부분은 계속 공부를 해봐야 할 것 같다.

## 코루틴 (Coroutine)
- **코루틴**이란, *cooperative routine* 의 약어이며, 서로 협력하는 루틴이라는 의미이다.
- 코루틴은 메인 루틴과 서브 루틴처럼 종속된 관계가 아니라 서로 대등한 관계이다.
- 코루틴은 특정 시점에 상대방의 코드를 실행한다.
- 즉, 함수의 호출이 끝날때까지 계속 대기하는 것이 아니라, 대기하는 동안에 다른 일을 처리한다.

### 루틴 (Routine)
- 루틴이란, 어떤 작업을 정의한 명령어의 집합을 의미한다.
- 즉, 함수, 모듈 등이 루틴이 되는 것이다.
- 메인 루틴(main routine)은 작업 흐름의 기본이 되는 루틴이다.
- 서브 루틴(sub routine)은 메인 루틴의 흐름에 종속된 루틴을 의미한다.
- 주로 서브 루틴을 함수라고 표현한다.

## 파이썬에서의 코루틴
파이썬에서는 코루틴은 크게 두 가지로 분류된다.
1. 일반적인 코루틴 (제너레이터 함수의 특별한 형태)
2. `async` 키워드와 `await` 로 호출이 가능한 함수

### 일반적인 코루틴
- 제너레이터는 `yield` 키워드를 통해 값을 생성한다.
- 코루틴으로 만들 경우, `변수 =(yield)` 와 같은 형태로 정의하여 외부로부터 값을 얻을 수 있다.
- `next` 함수를 통해 코루틴 안의 코드를 처음 실행시켜서 `yield` 까지 코드를 수행한다.
- 정의된 코루틴으로 생성된 코루틴 객체는 `send` 메서드를 갖는다.
- `send` 메서드를 통해 코루틴으로 값을 보낼 수 있다.

#### 예시
아래는 간단한 코루틴을 정의한 예시이다.
```python
def coroutine():
    while True:
        # 함수 외부에서 값을 받아온다.
        # 값을 받아오려면 '변수명 = (yield)' 와 같이 선언한다.
        x = (yield)
        print('받아온 값:', x)


cor = coroutine()
# 제너레이터를 사용할 때 'next' 함수를 통해 다음 값을 불러왔다.
# 코루틴은 'next' 함수를 통해 초기화 작업을 진행한다.
next(cor)

# 'send' 메서드를 통해 값을 보낸다.
cor.send(10)
cor.send('안녕하세요.')
cor.send('흔한 찐따입니다.')
cor.send(3.14)
```

**결과**
```
받아온 값: 10
받아온 값: 안녕하세요.
받아온 값: 흔한 찐따입니다.
받아온 값: 3.14
```

- 위의 예시에서 살펴볼 수 있듯, 코루틴 함수에 값을 보내는 것이 가능하다.
- 또한, 코루틴을 초기화 할때, `next` 함수를 사용하지 않고 `send` 메서드에 `None` 값을 넘겨주어도 같은 결과를 낼 수 있다.

```python
cor = coroutine()
cor.send(None)
cor.send(10)
```

다시 아래의 예시를 살펴보자.

```python
def coroutine():
    y = 0
    while True:
        x = (yield y)
        print('코루틴 호출:', x)
        y += x


cor = coroutine()
cor.send(None)

# '1'가 출력된다.
x = cor.send(1)
print('x:', x)

# '3'이 출력된다.
x = cor.send(2)
print('x:', x)

# '6'가 출력된다.
x = cor.send(3)
print('x:', x)

# '10'이 출력된다.
x = cor.send(4)
print('x:', x)
```

**결과**
```
코루틴 호출: 1
x: 1
코루틴 호출: 2
x: 3
코루틴 호출: 3
x: 6
코루틴 호출: 4
x: 10
```

### 정리
위의 예시로부터 알 수 있는 사실은 다음과 같다.
1. 메인 루틴은 코루틴을 호출하는 부분이다.
    - 즉, 위의 예시에서의 코루틴 외부에 해당한다.
2. 코루틴은 서브 루틴이다.
    - 위의 예시에서도 알 수 있듯, 코루틴은 메인 루틴의 작업을 위해 존재한다.
3. 그러나 메인 루틴과 서브 루틴이 동등한 관계이다.
    - 실행 결과를 보면 알 수 있듯, 메인 루틴이 실행되고 그 후에 코루틴이 실행된다.
4. 메인 루틴과 코루틴은 "*티키타카(?)*" 하는 관계이다.
    - 실행 결과를 보면 알 수 있듯, 호출되는 순서와 그로 인한 반환값이 "*티키타카(?)*" 되고 있음을 알 수 있다.
    - 위의 결과를 확인해보면 코루틴 호출이 종료된 후에 `y` 값이 다시 `0` 으로 초기화되지 않고 제너레이터처럼 계속 유지되고 있음을 확인할 수 있다.
    - 이는 달리 말하자면, 제너레이터는 코루틴의 일반적인 형태라고도 볼 수 있다.
