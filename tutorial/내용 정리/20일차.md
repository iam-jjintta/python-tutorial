# 흔한 찐따의 파이썬 20일차 내용 정리
이번에는 내가 파이썬으로 프로그래밍을 하면서 겪었던 문제점과 그 해결법들을 정리해놓았다.

## 실수(부동 소수점) 연산 문제
이 문제는 내가 `try-except-finally` 문을 공부하고 있었을 때 우연찮게 발견한 문제였다.

### 문제
나는 다음과 같은 작업을 수행하는 프로그램 코드를 작성했었다.
1. 사용자로부터 첫번째 수와 두번째 수를 입력값으로 받는다.
2. 입력값으로 받은 첫번째 수와 두번째 수를 덧셈 연산을 한 후에 그 결과를 출력한다.
3. 만약 연산된 결과가 원주율인 `pi(π)` 라면, `원주율입니다.` 라는 메시지를 대신 출력하도록 한다.

그래서 맨 처음에는 아래와 같이 코드를 작성했다.
```python
x = input('첫번째 수를 입력하세요: ')
y = input('두번째 수를 입력하세요: ')

try:
    x = float(x)
    y = float(y)

except Exception as e:
    print('잘못된 입력값입니다.')

finally:
    if x + y == 3.14:
        print('원주율입니다.')
    else:
        print(f'{x} + {y} = {x + y}')
```

그 다음, 위의 코드를 실행한 뒤에 아래처럼 `3.1` 과 `0.04` 를 입력값으로 주었다.
```
첫번째 수를 입력하세요: 3.1
두번째 수를 입력하세요: 0.04
원주율입니다.
```

위의 결과는 정상적으로 출력되었다.

그러나, 내가 우연찮게 값을 `2` 와 `1.14` 로 입력해봤는데, 이렇게 값을 입력하면 아래처럼 이상한 결과가 나온다.
```
첫번째 수를 입력하세요: 2
두번째 수를 입력하세요: 1.14
2.0 + 1.14 = 3.1399999999999997
```

### 원인
그래서 나는 이 문제점이 왜 발생하는지 찾아보았는데,
그 원인은 바로 **파이썬에서는 실수를 표현하기 위해 근산값으로 반올림하는데, 그 과정에서 부동 소수점 반올림 오차가 발생해서 그렇다.**

컴퓨터에서는 부동 소수점을 근산값으로 표현할 때 **머신 앱실론(Machine Epsilon)** 이라는 것을 사용한다다.
머신 앱실론이란, 1과 1 위의 부동 소수점 사이의 간격을 의미한다.
파이썬에서는 머신 앱실론에 의해 부동 소수점 연산 시 오차가 발생하게 된다.
따라서 `2.0 + 1.14` 와 같은 연산을 했을 때, `3.14` 가 아닌, 그 근산값인 `3.1399999999999997` 가 나오게 되는 것이었다.

### 해결
결론부터 이야기하자면, **파이썬에서 부동 소수점 연산을 하는 경우, 비교 연산자를 사용하면 안 된다.**

그 대신, 파이썬 표준 라이브러리인 `math` 를 사용해서 비교해야 한다.
파이썬 공식 문서의 [math](https://docs.python.org/ko/3/library/math.html)에 자세한 내용이 있다.
`math` 라이브러리에서 제공되는 `isclose` 함수를 사용해서 비교하면 이 문제를 해결할 수 있다.
```python
import math

x = input('첫번째 수를 입력하세요: ')
y = input('두번째 수를 입력하세요: ')

try:
    x = float(x)
    y = float(y)

except Exception as e:
    print('잘못된 입력값입니다.')

finally:
    if math.isclose(x + y, 3.14):
        print('원주율입니다.')
    else:
        print(f'{x} + {y} = {x + y}')
```

**결과**
```
첫번째 수를 입력하세요: 2
두번째 수를 입력하세요: 1.14
원주율입니다.
```

그러나, `isclose` 함수는 파이썬 3.5 버전 이상부터 사용이 가능하다.
때문에 십진 고정 소수점 및 부동 소수점 산술을 위한 파이썬 표준 라이브러리인 `decimal` 을 사용하는 것이 좋다.
`decimal` 라이브러리의 `Decimal` 객체로 부동 소수점을 비교하는 것이 가능하다.
```python
from decimal import Decimal

x = input('첫번째 수를 입력하세요: ')
y = input('두번째 수를 입력하세요: ')

try:
    x = Decimal(x)
    y = Decimal(y)
    z = x + y

except Exception as e:
    print('잘못된 입력값입니다.')

finally:
    pi = Decimal('3.14')
    if z == pi:
        print('원주율입니다.')
    else:
        print(f'{float(x)} + {float(y)} = {float(z)}')
```

**결과**
```
첫번째 수를 입력하세요: 2
두번째 수를 입력하세요: 1.14
원주율입니다.
```

### 참고
아래는 이 문제점을 해결하기 위해 내가 침고헸던 문서들이다.
- 기술 문서: [Floating Point Math](https://0.30000000000000004.com/)
- 논문: [모든 컴퓨터 과학자가 알아야할 부동 소수점의 모든 것](https://modoocode.com/attachment/%EB%AA%A8%EB%93%A0%20%EC%BB%B4%ED%93%A8%ED%84%B0%20%EA%B3%BC%ED%95%99%EC%9E%90%EA%B0%80%20%EC%95%8C%EC%95%84%EC%95%BC%20%ED%95%A0%20%EB%B6%80%EB%8F%99%20%EC%86%8C%EC%88%98%EC%A0%90%EC%9D%98%20%EB%AA%A8%EB%93%A0%EA%B2%83.pdf)
- 파이썬 표준 라이브러리 공식 문서: [decimal — 십진 고정 소수점 및 부동 소수점 산술](https://docs.python.org/ko/3/library/decimal.html)
